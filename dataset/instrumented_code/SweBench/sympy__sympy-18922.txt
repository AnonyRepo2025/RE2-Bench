diff --git a/sympy/plotting/tests/test_textplot.py b/sympy/plotting/tests/test_textplot.py
index d1238bc..3eed58c 100644
--- a/sympy/plotting/tests/test_textplot.py
+++ b/sympy/plotting/tests/test_textplot.py
@@ -5,47 +5,50 @@
 def test_axes_alignment():
     x = Symbol('x')
     lines = [
-        "      1 |                                                      ..",
-        "        |                                                   ...  ",
-        "        |                                                ...     ",
-        "        |                                            ....        ",
-        "        |                                         ...            ",
-        "        |                                      ...               ",
-        "        |                                   ...                  ",
-        "        |                                ...                     ",
-        "0.05882 | ----------------------------...------------------------",
-        "        |                         ....                           ",
-        "        |                      ...                               ",
-        "        |                   ...                                  ",
-        "        |                ...                                     ",
-        "        |             ...                                        ",
-        "        |         ....                                           ",
-        "        |      ...                                               ",
-        "        |   ...                                                  ",
-        "     -1 | ..                                                     ",
-        "          -1                         0                          1"
+        '      1 |                                                     ..',
+        '        |                                                  ...  ',
+        '        |                                                ..     ',
+        '        |                                             ...       ',
+        '        |                                          ...          ',
+        '        |                                        ..             ',
+        '        |                                     ...               ',
+        '        |                                  ...                  ',
+        '        |                                ..                     ',
+        '        |                             ...                       ',
+        '      0 |--------------------------...--------------------------',
+        '        |                       ...                             ',
+        '        |                     ..                                ',
+        '        |                  ...                                  ',
+        '        |               ...                                     ',
+        '        |             ..                                        ',
+        '        |          ...                                          ',
+        '        |       ...                                             ',
+        '        |     ..                                                ',
+        '        |  ...                                                  ',
+        '     -1 |_______________________________________________________',
+        '         -1                         0                          1'
     ]
     assert lines == list(textplot_str(x, -1, 1))
 
     lines = [
-        '      1 |                                                      ..',
-        '        |                                                  ....  ',
-        '        |                                               ...      ',
-        '        |                                            ...         ',
-        '        |                                        ....            ',
-        '        |                                     ...                ',
-        '        |                                  ...                   ',
-        '        |                              ....                      ',
-        '      0 | --------------------------...--------------------------',
-        '        |                       ....                             ',
-        '        |                    ...                                 ',
-        '        |                 ...                                    ',
-        '        |             ....                                       ',
-        '        |          ...                                           ',
-        '        |       ...                                              ',
-        '        |   ....                                                 ',
-        '     -1 | ..                                                     ',
-        '          -1                         0                          1'
+        '      1 |                                                     ..',
+        '        |                                                 ....  ',
+        '        |                                              ...      ',
+        '        |                                           ...         ',
+        '        |                                       ....            ',
+        '        |                                    ...                ',
+        '        |                                 ...                   ',
+        '        |                             ....                      ',
+        '      0 |--------------------------...--------------------------',
+        '        |                      ....                             ',
+        '        |                   ...                                 ',
+        '        |                ...                                    ',
+        '        |            ....                                       ',
+        '        |         ...                                           ',
+        '        |      ...                                              ',
+        '        |  ....                                                 ',
+        '     -1 |_______________________________________________________',
+        '         -1                         0                          1'
     ]
     assert lines == list(textplot_str(x, -1, 1, H=17))
 
@@ -53,48 +56,53 @@ def test_axes_alignment():
 def test_singularity():
     x = Symbol('x')
     lines = [
-        '     54 |  .                                                     ',
-        '        |                                                        ',
-        '        |                                                        ',
-        '        |                                                        ',
-        '        |                                                        ',
-        '        |                                                        ',
-        '        |                                                        ',
-        '        |                                                        ',
-        '29.0588 | -------------------------------------------------------',
-        '        |   .                                                    ',
-        '        |                                                        ',
-        '        |                                                        ',
-        '        |    .                                                   ',
-        '        |     \\                                                  ',
-        '        |      ..                                                ',
-        '        |        ...                                             ',
-        '        |           ............                                 ',
-        '      1 |                       .................................',
-        '          0                          0.5                        1'
+        '     54 | .                                                     ',
+        '        |                                                       ',
+        '        |                                                       ',
+        '        |                                                       ',
+        '        |                                                       ','        |                                                       ',
+        '        |                                                       ',
+        '        |                                                       ',
+        '        |                                                       ',
+        '        |                                                       ',
+        '   27.5 |--.----------------------------------------------------',
+        '        |                                                       ',
+        '        |                                                       ',
+        '        |                                                       ',
+        '        |   .                                                   ',
+        '        |    \\                                                  ',
+        '        |     \\                                                 ',
+        '        |      ..                                               ',
+        '        |        ...                                            ',
+        '        |           .............                               ',
+        '      1 |_______________________________________________________',
+        '         0                          0.5                        1'
     ]
     assert lines == list(textplot_str(1/x, 0, 1))
 
     lines = [
-        '-4.4408 |                                                  ......',
-        '        |                                       ...........      ',
-        '        |                                .......                 ',
-        '        |                         .......                        ',
-        '        |                    .....                               ',
-        '        |                ....                                    ',
-        '        |             ...                                        ',
-        '        |           ..                                           ',
-        '-1.8771 | --------..---------------------------------------------',
-        '        |       ..                                               ',
-        '        |      /                                                 ',
-        '        |     /                                                  ',
-        '        |    .                                                   ',
-        '        |                                                        ',
-        '        |   .                                                    ',
-        '        |                                                        ',
-        '        |                                                        ',
-        '-3.9889 |  .                                                     ',
-        '          0                          0.5                        1'
+        '      0 |                                                 ......',
+        '        |                                         ........      ',
+        '        |                                 ........              ',
+        '        |                           ......                      ',
+        '        |                      .....                            ',
+        '        |                  ....                                 ',
+        '        |               ...                                     ',
+        '        |             ..                                        ',
+        '        |          ...                                          ',
+        '        |         /                                             ',
+        '     -2 |-------..----------------------------------------------',
+        '        |      /                                                ',
+        '        |     /                                                 ',
+        '        |    /                                                  ',
+        '        |   .                                                   ',
+        '        |                                                       ',
+        '        |  .                                                    ',
+        '        |                                                       ',
+        '        |                                                       ',
+        '        |                                                       ',
+        '     -4 |_______________________________________________________',
+        '         0                          0.5                        1'
     ]
     assert lines == list(textplot_str(log(x), 0, 1))
 
@@ -102,25 +110,28 @@ def test_singularity():
 def test_sinc():
     x = Symbol('x')
     lines = [
-        '0.97729 |                           . .                          ',
-        '        |                          /   \\                         ',
-        '        |                         .     .                        ',
-        '        |                                                        ',
-        '        |                        .       .                       ',
-        '        |                                                        ',
-        '        |                                                        ',
-        '        |                       .         .                      ',
-        '0.41528 | -------------------------------------------------------',
-        '        |                      .           .                     ',
-        '        |                                                        ',
-        '        |                     .             .                    ',
-        '        |      ...                                       ...     ',
-        '        |    ..   ..         .               .         ..   ..   ',
-        '        |  ..       \\                                 /       .. ',
-        '        | /          \\      .                 .      /          \\',
-        '        |             ..   /                   \\   ..            ',
-        '-0.2169 |               ...                     ...              ',
-        '          -10                        0                          10'
+        '      1 |                          . .                          ',
+        '        |                         .   .                         ',
+        '        |                                                       ',
+        '        |                        .     .                        ',
+        '        |                                                       ',
+        '        |                       .       .                       ',
+        '        |                                                       ',
+        '        |                                                       ',
+        '        |                      .         .                      ',
+        '        |                                                       ',
+        '    0.4 |-------------------------------------------------------',
+        '        |                     .           .                     ',
+        '        |                                                       ',
+        '        |                    .             .                    ',
+        '        |                                                       ',
+        '        |    .....                                     .....    ',
+        '        |  ..     \\         .               .         /     ..  ',
+        '        | /        \\                                 /        \\ ',
+        '        |/          \\      .                 .      /          \\',
+        '        |            \\    /                   \\    /            ',
+        '   -0.2 |_______________________________________________________',
+        '         -10                        0                          10'
     ]
     assert lines == list(textplot_str(sin(x)/x, -10, 10))
 
@@ -128,47 +139,53 @@ def test_sinc():
 def test_imaginary():
     x = Symbol('x')
     lines = [
-        '      1 |                                                      ..',
-        '        |                                                   ...  ',
-        '        |                                                ...     ',
-        '        |                                              ..        ',
-        '        |                                           ...          ',
-        '        |                                         ..             ',
-        '        |                                       ..               ',
-        '        |                                     ..                 ',
-        '0.52941 | ----------------------------------..-------------------',
-        '        |                                  /                     ',
-        '        |                                ..                      ',
-        '        |                               /                        ',
-        '        |                              .                         ',
-        '        |                                                        ',
-        '        |                             .                          ',
-        '        |                                                        ',
-        '        |                                                        ',
-        '      0 |                            .                           ',
-        '          -1                         0                          1'
+        '      1 |                                                     ..',
+        '        |                                                   ..  ',
+        '        |                                                ...    ',
+        '        |                                              ..       ',
+        '        |                                            ..         ',
+        '        |                                          ..           ',
+        '        |                                        ..             ',
+        '        |                                      ..               ',
+        '        |                                    ..                 ',
+        '        |                                   /                   ',
+        '    0.5 |----------------------------------/--------------------',
+        '        |                                ..                     ',
+        '        |                               /                       ',
+        '        |                              .                        ',
+        '        |                                                       ',
+        '        |                             .                         ',
+        '        |                            .                          ',
+        '        |                                                       ',
+        '        |                                                       ',
+        '        |                                                       ',
+        '      0 |_______________________________________________________',
+        '         -1                         0                          1'
     ]
     assert list(textplot_str(sqrt(x), -1, 1)) == lines
 
     lines = [
-        '      1 |                                                        ',
-        '        |                                                        ',
-        '        |                                                        ',
-        '        |                                                        ',
-        '        |                                                        ',
-        '        |                                                        ',
-        '        |                                                        ',
-        '        |                                                        ',
-        '0.05882 | -------------------------------------------------------',
-        '        |                                                        ',
-        '        |                                                        ',
-        '        |                                                        ',
-        '        |                                                        ',
-        '        |                                                        ',
-        '        |                                                        ',
-        '        |                                                        ',
-        '        |                                                        ',
-        '     -1 |                                                        ',
-        '          -1                         0                          1'
+        '      1 |                                                       ',
+        '        |                                                       ',
+        '        |                                                       ',
+        '        |                                                       ',
+        '        |                                                       ',
+        '        |                                                       ',
+        '        |                                                       ',
+        '        |                                                       ',
+        '        |                                                       ',
+        '        |                                                       ',
+        '      0 |-------------------------------------------------------',
+        '        |                                                       ',
+        '        |                                                       ',
+        '        |                                                       ',
+        '        |                                                       ',
+        '        |                                                       ',
+        '        |                                                       ',
+        '        |                                                       ',
+        '        |                                                       ',
+        '        |                                                       ',
+        '     -1 |_______________________________________________________',
+        '         -1                         0                          1'
     ]
     assert list(textplot_str(S.ImaginaryUnit, -1, 1)) == lines
diff --git a/sympy/plotting/textplot.py b/sympy/plotting/textplot.py
index 4b8bffb..1c6e6c6 100644
--- a/sympy/plotting/textplot.py
+++ b/sympy/plotting/textplot.py
@@ -1,4 +1,197 @@
 from __future__ import print_function, division
+import inspect
+def recursive_object_seralizer(obj, visited):
+    seralized_dict = {}
+    keys = list(obj.__dict__)
+    for k in keys:
+        if id(obj.__dict__[k]) in visited:
+            seralized_dict[k] = "<RECURSIVE {}>".format(obj.__dict__[k])
+            continue
+        if isinstance(obj.__dict__[k], (float, int, str, bool, type(None))):
+            seralized_dict[k] = obj.__dict__[k]
+        elif isinstance(obj.__dict__[k], tuple):
+            ## handle tuple
+            seralized_dict[k] = recursive_tuple_seralizer(obj.__dict__[k], visited)
+        elif isinstance(obj.__dict__[k], set):
+            ## handle set
+            seralized_dict[k] = recursive_set_seralizer(obj.__dict__[k], visited)
+        elif isinstance(obj.__dict__[k], list):
+            ## handle list
+            seralized_dict[k] = recursive_list_seralizer(obj.__dict__[k], visited)
+        elif hasattr(obj.__dict__[k], '__dict__'):
+            ## handle object
+            visited.append(id(obj.__dict__[k]))
+            seralized_dict[k] = recursive_object_seralizer(obj.__dict__[k], visited)
+        elif isinstance(obj.__dict__[k], dict):
+            visited.append(id(obj.__dict__[k]))
+            seralized_dict[k] = recursive_dict_seralizer(obj.__dict__[k], visited)
+        elif callable(obj.__dict__[k]):
+            ## handle function
+            if hasattr(obj.__dict__[k], '__name__'):
+                seralized_dict[k] = "<function {}>".format(obj.__dict__[k].__name__)
+        else:
+            seralized_dict[k] = str(obj.__dict__[k])
+    return seralized_dict
+
+def recursive_dict_seralizer(dictionary, visited):
+    seralized_dict = {}
+    keys = list(dictionary)
+    for k in keys:
+        if id(dictionary[k]) in visited:
+            seralized_dict[k] = "<RECURSIVE {}>".format(dictionary[k])
+            continue
+        # if isinstance(dictionary[k], (float, int, str, bool, type(None))):
+        #     pass
+        # else:
+        #     visited.append(id(dictionary[k]))
+        if isinstance(dictionary[k], (float, int, str, bool, type(None))):
+            seralized_dict[k] = dictionary[k]
+        elif isinstance(dictionary[k], list):
+            seralized_dict[k] = recursive_list_seralizer(dictionary[k], visited)
+        elif isinstance(dictionary[k], tuple):
+            seralized_dict[k] = recursive_tuple_seralizer(dictionary[k], visited)
+        elif isinstance(dictionary[k], set):
+            seralized_dict[k] = recursive_set_seralizer(dictionary[k], visited)        
+        elif hasattr(dictionary[k], '__dict__'):
+            visited.append(id(dictionary[k]))
+            seralized_dict[k] = recursive_object_seralizer(dictionary[k], visited)
+        elif callable(dictionary[k]):
+            if hasattr(dictionary[k], '__name__'):
+                seralized_dict[k] = "<function {}>".format(dictionary[k].__name__)
+        elif isinstance(dictionary[k], dict):
+            visited.append(id(dictionary[k]))
+            seralized_dict[k] = recursive_dict_seralizer(dictionary[k], visited)
+        else:
+            seralized_dict[k] =str(dictionary[k])
+    return seralized_dict   
+
+def recursive_set_seralizer(set_data, visited):
+    new_set = set()
+    for s in set_data:
+        if id(s) in visited:
+            continue 
+        if isinstance(s, (float, int, str, bool, type(None))):
+            new_set.add(s)
+        elif isinstance(s, tuple):
+            new_set.add(recursive_tuple_seralizer(s, visited))
+        elif isinstance(s, list):
+            new_set.add(recursive_list_seralizer(s, visited))
+        elif isinstance(s, set):
+            new_set.add(recursive_set_seralizer(s,visited))
+        elif isinstance(s, dict):
+            visited.append(id(s))
+            new_set.add(recursive_dict_seralizer(s, visited))
+        elif hasattr(s, '__dict__'):
+            visited.append(id(s))
+            new_set.add(str(recursive_object_seralizer(s, visited)))
+        elif callable(s):
+            if hasattr(s, '__name__'):
+                new_set.add("<function {}>".format(s.__name__))
+        else:
+            new_set.add(str(s))
+    return new_set
+    
+
+def recursive_tuple_seralizer(tup, visited):
+    new_tup = ()
+    for t in tup:
+        if id(t) in visited:
+           continue
+        if isinstance(t, (float, int, str, bool, type(None))):
+            new_tup = (*new_tup, t)
+        elif isinstance(t, tuple):
+            new_tup = (*new_tup, recursive_tuple_seralizer(t, visited))
+        elif isinstance(t, list):
+            new_tup = (*new_tup, recursive_list_seralizer(t, visited))
+        elif isinstance(t, set):
+            new_tup = (*new_tup, recursive_set_seralizer(t, visited))
+        elif isinstance(t, dict):
+            visited.append(id(t))
+            new_tup = (*new_tup, recursive_dict_seralizer(t, visited))
+        elif hasattr(t, '__dict__'):
+            visited.append(id(t))
+            new_tup = (*new_tup, recursive_object_seralizer(t, visited))
+        elif callable(t):
+            if hasattr(t, '__name__'):
+                new_tup = (*new_tup, "<function {}>".format(t.__name__))
+        else:
+            new_tup = (*new_tup, str(t))
+    return new_tup
+
+def recursive_list_seralizer(li, visited):
+    new_list = []
+    for l in li:
+        if id(l) in visited:
+            continue
+        if isinstance(l, (float, int, str, bool, type(None))):
+            new_list.append(l)
+        elif isinstance(l, tuple):
+            new_list.append(recursive_tuple_seralizer(l, visited))
+        elif isinstance(l, list):
+            new_list.append(recursive_list_seralizer(l, visited))
+        elif isinstance(l, set):
+            new_list.append(recursive_set_seralizer(l, visited))
+        elif hasattr(l, '__dict__'):
+            visited.append(id(l))
+            new_list.append(recursive_object_seralizer(l, visited))
+        elif isinstance(l, dict):
+            visited.append(id(l))
+            new_list.append(recursive_dict_seralizer(l, visited))
+        elif callable(l):
+            if hasattr(l, '__name__'):
+                new_list.append("<function {}>".format(l.__name__))
+        else:
+            new_list.append(str(l))       
+
+def inspect_code(func):
+    def wrapper(*args, **kwargs):
+        visited = []
+        filename = "/home/changshu/CODEMIND/scripts/swebench/swebench_playground/obj/sympy__sympy-18922/sympy/plotting/textplot.py"
+        para_dict = {"name": func.__name__}
+        args_names = inspect.getfullargspec(func).args
+        if len(args) > 0 and hasattr(args[0], '__dict__') and args_names[0] == 'self':
+            ## 'self'
+            self_args = args[0]
+            para_dict['self'] = recursive_object_seralizer(self_args, [id(self_args)])
+        else:
+            para_dict['self'] = {}
+        if len(args) > 0 :
+            if args_names[0] == 'self':
+                other_args = {}
+                for m,n in zip(args_names[1:], args[1:]):
+                    other_args[m] = n
+            else:
+                other_args = {}
+                for m,n in zip(args_names, args):
+                    other_args[m] = n
+            para_dict['args'] = recursive_dict_seralizer(other_args, [id(other_args)])
+        else:
+            para_dict['args'] = {}
+        if kwargs:
+            para_dict['kwargs'] = recursive_dict_seralizer(kwargs, [id(kwargs)])
+        else:
+            para_dict['kwargs'] = {}
+            
+        result = func(*args, **kwargs)
+        ## seralize the return value
+        if isinstance(result, tuple):
+            ret = recursive_tuple_seralizer(result, [])
+        elif isinstance(result, (float, int, str)):
+            ret = result
+        elif isinstance(result, list):
+            ret = recursive_list_seralizer(result, [])
+        elif isinstance(result, dict):
+            ret = recursive_dict_seralizer(result, [])
+        elif hasattr(result, '__dict__'):
+            ret = recursive_object_seralizer(result, [])
+        elif callable(result):
+            ret = "<function {}>".format(result.__name__)
+        else:
+            ret = str(result)
+        para_dict["return"] = ret
+        print("@[DATA]@", filename,"[SEP]", para_dict, "[/SEP]")
+        return result
+    return wrapper
 
 from sympy.core.numbers import Float
 from sympy.core.symbol import Dummy
@@ -45,7 +238,8 @@ def linspace(start, stop, num):
     return [start + (stop - start) * x / (num-1) for x in range(num)]
 
 
-def textplot_str(expr, a, b, W=55, H=18):
+@inspect_code
+def textplot_str(expr, a, b, W=55, H=21):
     """Generator for the lines of the plot"""
     free = expr.free_symbols
     if len(free) > 1:
@@ -79,6 +273,11 @@ def textplot_str(expr, a, b, W=55, H=18):
                 mi, ma = -1, 1
     else:
         mi, ma = -1, 1
+    y_range = ma - mi
+    precision = math.floor(math.log(y_range, 10)) - 1
+    precision *= -1
+    mi = round(mi, precision)
+    ma = round(ma, precision)
     y = rescale(y, W, H, mi, ma)
 
     y_bins = linspace(mi, ma, H)
@@ -96,6 +295,10 @@ def textplot_str(expr, a, b, W=55, H=18):
                 else:
                     s[i] = '.'
 
+        if h == 0:
+            for i in range(W):
+                s[i] = '_'
+
         # Print y values
         if h in (0, H//2, H - 1):
             prefix = ("%g" % y_bins[h]).rjust(margin)[:margin]
@@ -104,10 +307,10 @@ def textplot_str(expr, a, b, W=55, H=18):
         s = "".join(s)
         if h == H//2:
             s = s.replace(" ", "-")
-        yield prefix + " | " + s
+        yield prefix + " |" + s
 
     # Print x values
-    bottom = " " * (margin + 3)
+    bottom = " " * (margin + 2)
     bottom += ("%g" % x[0]).ljust(W//2)
     if W % 2 == 1:
         bottom += ("%g" % x[W//2]).ljust(W//2)
@@ -117,7 +320,8 @@ def textplot_str(expr, a, b, W=55, H=18):
     yield bottom
 
 
-def textplot(expr, a, b, W=55, H=18):
+@inspect_code
+def textplot(expr, a, b, W=55, H=21):
     r"""
     Print a crude ASCII art plot of the SymPy expression 'expr' (which
     should contain a single symbol, e.g. x or something else) over the
@@ -130,25 +334,28 @@ def textplot(expr, a, b, W=55, H=18):
     >>> from sympy.plotting import textplot
     >>> t = Symbol('t')
     >>> textplot(sin(t)*t, 0, 15)
-    14.1605 |                                                   ...
-            |                                                      .
-            |                                                  .
-            |                                                 .     .
-            |                             ..
-            |                            /  ..               .
-            |                           /     .
-            |                          /
-    2.30284 | ------...---------------/--------.------------.--------
-            |   ....   ...           /
-            | ..          \         /           .          .
-            |              ..      /             .
-            |                ..   /                       .
-            |                  ...                .
-            |                                            .
-            |                                      .
-            |                                       \   .
-    -11.037 |                                        ...
-            0                          7.5                        15
+     14 |                                                  ...
+        |                                                     .
+        |                                                 .
+        |                                                      .
+        |                                                .
+        |                            ...
+        |                           /   .               .
+        |                          /
+        |                         /      .
+        |                        .        .            .
+    1.5 |----.......--------------------------------------------
+        |....       \           .          .
+        |            \         /                      .
+        |             ..      /             .
+        |               \    /                       .
+        |                ....
+        |                                    .
+        |                                     .     .
+        |
+        |                                      .   .
+    -11 |_______________________________________________________
+         0                          7.5                        15
     """
     for line in textplot_str(expr, a, b, W, H):
         print(line)
